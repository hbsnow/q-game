# さめがめオーシャン 仕様

## ゲームの概要

**さめがめオーシャン**は、海をテーマにしたカジュアルなパズルゲームです。同じ色のブロックを消してスコアを稼ぎ、獲得したゴールドでガチャを引いて便利なアイテムをゲット。段階的に難しくなるステージを攻略していくパズルゲームです。

## 基本的な遊び方

### 1. ブロックを消してゴールドを稼ごう

- 同じ色で隣り合っている 2 個以上のブロックをタップ
- 「隣り合っている」とは上下左右の 4 方向のみを指し、斜めは含まない
- 1 回の操作で 1 箇所の同色ブロック群のみを消去できる
- ブロックが消えて、上から新しいブロックが落ちてくる
- 大きな塊を消すほど高得点。目標スコア達成でゴールド獲得

### 2. ガチャでアイテムをゲット

- 獲得したゴールドでガチャを引く
- 爆弾、色変更、障害物除去など便利なアイテムが当たる
- ステージが進むとより強力なアイテムが手に入るガチャが解放

### 3. アイテムを使ってステージ攻略

- 難しいステージではアイテムを駆使して攻略
- 装備枠が 2 つあり、各枠に 1 つのアイテムをセット可能
- 各装備枠のアイテムは 1 ステージ内で 1 回だけ使用可能
- アイテムを装備しただけでは所持数は減らない
- アイテムを実際に使用した時点で所持数から 1 つ減少する
- 装備したアイテムを使用しなかった場合は、ステージ終了後に所持アイテムに戻される（消費されない）
- 全てのアイテムは使い捨てで、再利用可能なアイテムはない
- 戦略的にアイテムを使い分けて高スコアを目指そう

### 4. アイテム装備の制限

- 装備枠は「特殊枠」と「通常枠」の 2 つに分かれている
- 「特殊枠」には S・A レア度のアイテム（爆弾、スコアブースターなど）を装備可能
- 「通常枠」には B〜F レア度のアイテムのみ装備可能
- 特殊枠には通常アイテム（B〜F レア）も装備可能だが、通常枠に特殊アイテム（S・A レア）は装備不可
- 強力なアイテムの組み合わせを防ぎ、戦略的な選択を促す

#### 装備制限の設計意図

- **戦略的バランス調整**: S・A レアの強力アイテム（爆弾、スコアブースターなど）の同時使用を防ぐことで、ゲームバランスを保ち、過度に簡単になることを防止
- **装備枠の役割分担**:
  - **特殊枠**: S・A レア専用だが、通常アイテムも装備可能（柔軟性を提供）
  - **通常枠**: B〜F レア専用（強力アイテムの制限）
- **戦略的選択の促進**: プレイヤーは以下の選択を迫られる
  1. **特殊枠に S・A レア + 通常枠に B〜F レア**（バランス型）
  2. **特殊枠に通常アイテム + 通常枠に通常アイテム**（リソース管理型）

#### 特殊枠への通常アイテム装備戦略（リソース管理戦略）

- **戦略的位置づけ**: 「リソース管理戦略」として定義
- **具体的なメリット**:
  - **貴重なS・Aレアアイテムの温存**: 後のステージのために強力アイテムを節約
  - **通常アイテムの2個装備**: 両枠に同じアイテム（例：シャッフル×2）を装備可能
  - **簡単なステージでの節約プレイ**: ステージが簡単で強力アイテムが不要な場合
- **使用例**:
  - 温存戦略: ステージ50で爆弾を温存し、特殊枠にシャッフルを装備
  - 重複戦略: 特殊枠にシャッフル、通常枠にもシャッフルで計2回使用
  - 節約戦略: 簡単なステージでは両枠とも通常アイテムで攻略

## ゲームの特徴

### 成長要素のあるガチャシステム

- **オーシャンガチャ**: 常に同じガチャを引き、価格は一定（100G）
- **ステージ進行による成長**: ステージが進むにつれて出現するアイテムの種類が増加
- **アイテムの開放**: 各アイテムの「開放ステージ」は、そのアイテムがガチャから出現し始めるステージを示す
- **序盤**: 基本的なアイテムのみ出現（スワップ、チェンジワン、ミニ爆弾など）
- **中盤**: より強力なアイテムが追加（溶解剤、チェンジエリア、カウンターリセットなど）
- **終盤**: 最強アイテムも出現（爆弾、スコアブースター、スペシャルハンマーなど）

### レア度と排出確率

レア度が S > A > B > C > D > E > F の順で高く、レアが高いほどガチャで出にくい。
個別アイテムレベルでもレア度順序を保つため、以下の計算式を使用する。

#### 排出確率の計算式

```typescript
// 1アイテムあたりの基準確率（レア度順序を保つ）
const baseRarityRates = {
  S: 0.02,  // 2%
  A: 0.05,  // 5%
  B: 0.08,  // 8%
  C: 0.12,  // 12%
  D: 0.15,  // 15%
  E: 0.20,  // 20%
  F: 0.25   // 25%
};

// 各レア度の出現アイテム数をカウント
const itemCounts = {
  S: 出現可能なSレアアイテム数,
  A: 出現可能なAレアアイテム数,
  // ... 以下同様
};

// 各レア度の合計確率を計算
const totalRarityRates = {
  S: baseRarityRates.S * itemCounts.S,
  A: baseRarityRates.A * itemCounts.A,
  // ... 以下同様
};

// 全体を100%に正規化
const totalRate = 全レア度の合計確率;
const normalizedRates = {
  各レア度: (そのレア度の合計確率 / totalRate) * 100
};

// 個別アイテムの確率 = そのレア度の正規化確率 / そのレア度のアイテム数
```

#### 排出確率の適用方法

- **出現可能アイテムのみで確率計算**: 現在のステージで出現可能なアイテムの中からのみ抽選
- **レア度順序の保持**: 個別アイテムレベルでも S > A > B > C > D > E > F の順で出にくくなる
- **確率の正規化**: 出現可能なアイテムの確率合計が100%になるよう調整

### ステージ進行とレア度の関係

- **序盤（ステージ 1-10）**: F〜D レアのアイテムが出現
- **中盤前半（ステージ 11-30）**: F〜D レアのアイテムに加え、一部の C レアアイテムが出現
- **中盤後半（ステージ 31-60）**: F〜B レアのアイテムに加え、一部の A レアアイテムが出現
- **終盤（ステージ 61 以降）**: 全レア度のアイテムが出現

### 10 連ガチャの特典

- 10 連ガチャでは、最低 1 つは D 以上のレアアイテムが確定
- 価格は 1 回分と同じ（1 回 100G なら 10 連は 1000G）

### ガチャの演出と視覚表現

- **ガチャ演出**:

  - 宝箱が海底から浮かび上がるアニメーション
  - レア度に応じて宝箱の輝き方が変化（S・A レアは金色に輝く）
  - 宝箱が開いてアイテムが出現する演出

- **レア度の視覚表現**:

  - **色分け**:
    - S：虹色/金
    - A：赤
    - B：紫
    - C：青
    - D：緑
    - E：白
    - F：灰色
  - **アイコン**: レア度に応じて星の数（S=5 星、A=4 星...F=0 星）
  - **エフェクト**: レア度が高いほど派手な演出（S・A レアは特別なエフェクト）

- **ガチャ結果画面**:
  - **1 回引き**:
    - アイテム名、レア度、効果説明を表示
    - 「もう一度引く」「戻る」ボタン
  - **10 連引き**:
    - 10 個のアイテムをグリッド表示
    - 各アイテムをタップすると詳細表示
    - 「すべて確認」ボタンで一覧表示に切り替え
    - 「もう一度引く」「戻る」ボタン
- **重複アイテム表示**:
  - 既に所持しているアイテムが出た場合は「〇〇 +1」と表示
  - アイテム一覧画面では各アイテムの所持数をカウンターで表示
- **確率表示**:
  - ガチャ画面に確率表示ボタンを設置
  - タップすると各レア度の排出確率と出現アイテム一覧を表示

### 収集・育成要素

- **アイテムコレクション**: 様々なアイテムを集める楽しさ
- **ガチャの期待感**: 新しいガチャで何が出るかのワクワク感
- **戦略の幅**: 手に入れたアイテムで攻略法が広がる

### ガチャとアイテムの関係

- **重複アイテム**: 既に所持しているアイテムがガチャから出た場合、そのアイテムの所持数が増加する
- **アイテムストック**: 同じアイテムを複数所持することで、難しいステージに備えて戦略的に使用できる
- **所持上限**: 各アイテムの所持上限は 99 個で、それを超えると破棄される
- **消費システム**: アイテムは使用すると所持数が 1 つ減少する
- **表示方法**: アイテム一覧画面では各アイテムの所持数が表示される

## 登場する妨害ブロック（ステージ進行で追加）

### 氷結 Lv1

- 外観: 薄い半透明の氷に覆われたブロック、内部の色ブロックが透けて見える
- 初登場ステージ: 11
- 解除条件: 氷結ブロックの隣接位置（上下左右）で氷結ブロック自身と同じ色のブロックが 1 回消去されると解除
- 「隣接位置」とは氷結ブロックの上下左右 4 方向に隣接するマスを指し、斜めは含まない
- 例：氷結ブロックの内部が青色なら、隣接する青色のブロックを消去する必要がある
- 解除後: 氷が溶けて内部の通常色ブロックとして機能開始
- 物理挙動: 氷状態では他のブロックを消去する際のグループ形成には参加しないが、隣接する同色ブロックを消去することで解除できる。重力で落下する
- 視覚効果: 解除時にキラキラと氷が溶けるエフェクト

### カウンター+（以上型）

- 外観: ブロック中央に白い数字と「+」記号を表示（例：「3+」）
- 初登場ステージ: 21
- 解除条件: カウンターブロックと同じ色のブロックを指定数以上含むグループを形成し、そのグループを消去するとカウンターブロックも一緒に消去される
- カウンターブロック自身はグループ形成時に隣接判定に含まれ、カウント数にも含まれる
- 例: 「3+」のカウンターブロックの場合、そのブロックを含めて 3 つ以上の同色ブロックが隣接していれば消去可能
- 操作方法: カウンターブロック自体または隣接する同色ブロックのどちらをタップしても、条件を満たす場合は消去可能
- 解除後: 消去される（通常ブロックに変化するのではなく、直接消去される）
- 物理挙動: 重力で落下する
- 視覚効果: 解除時に数字が消えて消去されるアニメーション

### 氷結 Lv2

- 外観: 厚い氷枠に覆われ、表面に小さな雪の結晶マークが表示される
- 初登場ステージ: 31
- 解除条件: 氷結ブロックの隣接位置（上下左右）で氷結ブロック自身と同じ色のブロックが合計 2 回消去されると解除
- 「隣接位置」とは氷結ブロックの上下左右 4 方向に隣接するマスを指し、斜めは含まない
- 例：氷結ブロックの内部が青色なら、隣接する青色のブロックを消去する必要がある
- 消去は連続である必要はなく、別々のターンでも可能
- 段階変化:
  - 1 回目消去: 氷結 Lv1 と同じグラフィック
  - 2 回目消去: 氷が完全に溶けて通常色ブロック化
- 物理挙動: 氷状態では他のブロックを消去する際のグループ形成には参加しないが、隣接する同色ブロックを消去することで解除できる。重力で落下する
- 視覚効果: 段階的に氷が薄くなり、最終的に溶けるアニメーション

### カウンター（ちょうど型）

- 外観: ブロック中央に白い数字のみ表示（例：「3」）
- 初登場ステージ: 41
- 解除条件: カウンターブロックと同じ色のブロックをちょうど指定数含むグループを形成し、そのグループを消去するとカウンターブロックも一緒に消去される
- カウンターブロック自身はグループ形成時に隣接判定に含まれ、カウント数にも含まれる
- 例: 「3」のカウンターブロックの場合、そのブロックを含めてちょうど 3 つの同色ブロックが隣接していれば消去可能（4 つ以上では消去不可）
- 操作方法: カウンターブロック自体または隣接する同色ブロックのどちらをタップしても、条件を満たす場合は消去可能
- 解除後: 消去される（通常ブロックに変化するのではなく、直接消去される）
- 物理挙動: 重力で落下する
- 視覚効果: 解除時に数字が消えて消去されるアニメーション

### 氷結カウンター+

- 外観: 氷に覆われ、内部にカウンター+が透けて見える
- 初登場ステージ: 51
- 解除手順:
  1. 氷結ブロックの隣接位置（上下左右）で氷結ブロック自身と同じ色のブロックが 1 回消去されると氷が溶ける → カウンター+状態
  2. カウンターブロックと同じ色のブロックを指定数以上含むグループを形成し、そのグループを消去するとカウンターブロックも一緒に消去される
- 「隣接位置」とは氷結ブロックの上下左右 4 方向に隣接するマスを指し、斜めは含まない
- カウンター+状態になった後は、カウンターブロック自身はグループ形成時に隣接判定に含まれ、カウント数にも含まれる
- 物理挙動: 氷状態では他のブロックを消去する際のグループ形成には参加しないが、隣接する同色ブロックを消去することで解除できる。重力で落下する

### 岩ブロック

- 外観: 灰色の岩石テクスチャ、ザラザラした質感
- 初登場ステージ: 61
- 消去: アイテム以外での消去不可
- 物理挙動: 重力の影響を受けて落下する
- 隣接判定: 隣接カウントに含まれない（消去の邪魔をする）
- 用途: 消去パターンの分断、戦略ルートの制限

### 氷結カウンター

- 外観: 氷に覆われ、内部にカウンター（ちょうど型）が透けて見える
- 初登場ステージ: 71
- 解除手順:
  1. 氷結ブロックの隣接位置（上下左右）で氷結ブロック自身と同じ色のブロックが 1 回消去されると氷が溶ける → カウンター状態
  2. カウンターブロックと同じ色のブロックをちょうど指定数含むグループを形成し、そのグループを消去するとカウンターブロックも一緒に消去される
- 「隣接位置」とは氷結ブロックの上下左右 4 方向に隣接するマスを指し、斜めは含まない
- カウンター状態になった後は、カウンターブロック自身はグループ形成時に隣接判定に含まれ、カウント数にも含まれる
- 物理挙動: 氷状態では他のブロックを消去する際のグループ形成には参加しないが、隣接する同色ブロックを消去することで解除できる。重力で落下する

### 鋼鉄ブロック

- 外観: メタリックシルバー、金属光沢のある質感
- 初登場ステージ: 81
- 消去: アイテム以外での消去不可
- 物理挙動: 完全固定、重力の影響を受けない（空中に浮いていても落ちない）
- 隣接判定: 隣接カウントに含まれない
- 用途: ステージ形状の固定、特殊レイアウトの作成

## ガチャとアイテムの種類

レア度が S > A > B > C > D > E > F の順で高く、レアが高いほどガチャで出にくい。
S の排出確率は 5%になるように調整してください。

### スワップ

- 効果: 2 つの指定ブロックを入れ替える
- 開放ステージ: 1
- 使用方法: 対象のブロックを選択、岩ブロックと鋼鉄ブロック以外選択可能
- レア度: E

### チェンジワン

- 効果: 指定ブロック 1 個を指定色に変更
- 開放ステージ: 1
- 使用方法: 対象のブロックを選択、岩ブロックと鋼鉄ブロック以外選択可能
- レア度: D

### ミニ爆弾

- 効果: 1 マスの指定ブロックを消去、通常ブロックのみ消去可能で削除得点は入らない
- 開放ステージ: 1
- 使用方法: 対象の通常ブロックを選択、通常ブロック以外は選択不可
- レア度: F

### シャッフル

- 効果: 現状の盤面に存在する通常ブロックのみを再配置（妨害ブロックの位置は変わらない）
- 開放ステージ: 1
- 使用方法: アイテム使用時、即座に発動
- レア度: E

### 溶解剤（Melting Agent）

- 効果: 氷結ブロックの解除に必要な隣接消去回数を-1 する。氷結 Lv2→Lv1、氷結 Lv1→ 即座に解除
- 開放ステージ: 11
- 使用方法: 対象の氷結ブロックを選択
- レア度: E

### チェンジエリア

- 効果: 指定ブロックと同じ色で隣接している全てのブロック（通常のさめがめルールで一度に消せる範囲全体）を指定色に変更
- 開放ステージ: 11
- 使用方法: 対象のブロックを選択し、変更したい色を選択。岩ブロックと鋼鉄ブロック以外選択可能
- レア度: D

### カウンター+リセット（Counter Reset）

- 効果: 指定したカウンター+ブロックを通常ブロックにする
- 開放ステージ: 21
- 使用方法: 対象のカウンター+ブロックを選択
- レア度: F

### 爆弾

- 効果: 指定した場所を中心に 3×3 の範囲のブロックを消去
- 開放ステージ: 31
- 使用方法: 任意の場所をタップして発動
- 特徴: 鋼鉄ブロック以外の妨害ブロックも消去可能、ただし得点は入らない
- レア度: S

### アドプラス

- 効果: カウンターブロックをカウンター+ブロックに変化させる
- 開放ステージ: 41
- 使用方法: 対象のカウンターブロックを選択
- レア度: B

### スコアブースター

- 効果: 使用後からそのステージの獲得スコアを 1.5 倍にする
- 開放ステージ: 51
- 使用方法: 使用時からステージ終了まで適用
- レア度: A

### ハンマー

- 効果: 指定した岩ブロック 1 個を破壊
- 開放ステージ: 61
- 使用方法: 破壊したい岩ブロックを選択
- 制限: 岩ブロックにのみ使用可能
- レア度: C

### 鋼鉄ハンマー

- 効果: 指定した鋼鉄ブロック 1 個を破壊
- 開放ステージ: 81
- 使用方法: 破壊したい鋼鉄ブロックを選択
- 制限: 鋼鉄ブロックにのみ使用可能
- レア度: B

### スペシャルハンマー

- 効果: 指定したブロック 1 個を破壊
- 開放ステージ: 81
- 使用方法: 破壊したいブロックを選択
- 制限: 通常ブロック、岩ブロック、鋼鉄ブロックなど、あらゆる種類のブロックに使用可能
- レア度: S

## プレイの流れ

1. **ステージ挑戦**: パズルを解いて目標スコア達成
2. **ゴールド獲得**: スコアに応じたゴールドをゲット
3. **ガチャ**: ゴールドを使ってアイテムガチャ
4. **アイテム活用**: 次のステージで新しいアイテムを使用
5. **繰り返し**: より難しいステージに挑戦

## スコア計算方法

### 基本計算式

```
スコア = 消去したブロック数の二乗
```

例：

- 2 ブロック: 2² = 4 点
- 3 ブロック: 3² = 9 点
- 5 ブロック: 5² = 25 点
- 10 ブロック: 10² = 100 点
- 20 ブロック: 20² = 400 点

### 複数回消去の場合

```
合計スコア = 各消去ごとのスコアの合計
```

例：

- 2 ブロック消去と 3 ブロック消去を別々に行った場合: 2² + 3² = 4 + 9 = 13 点
- 5 ブロックをまとめて消した場合: 5² = 25 点
- 小さく分けて消すより、大きくまとめて消した方が高得点になる

### 全消しの定義

- 「全消し」とは、盤面上の消去可能な全てのブロックが解除・消去された状態を指す
- 消去可能ブロック：通常ブロック、氷結ブロック、カウンターブロック、カウンター+ブロック
- 消去不可能ブロック：岩ブロック、鋼鉄ブロック（全消し条件に含まれない）
- 氷結ブロックやカウンターブロックが未解除の状態では全消しとならない
- 全ての消去可能ブロックが解除・消去されて初めて全消しボーナスが適用される

### 全消しボーナス

```
全消しボーナス = 1.5倍（倍率）
```

- 全消し達成時に獲得スコアが1.5倍になる

### 最終スコア計算

```
最終スコア = 通常消去スコア × 全消しボーナス(1.5倍) × スコアブースター倍率
```

### スコア計算の詳細

#### アイテム別スコア処理

**直接消去系アイテム（スコア0）:**
- 爆弾: 消去したブロックはスコアに含まれない
- ミニ爆弾: 消去したブロックはスコアに含まれない
- ハンマー系: 消去したブロックはスコアに含まれない

**間接効果系アイテム（通常スコア適用）:**
- スワップ、チェンジワン、チェンジエリア: 効果後の通常消去は通常のスコア計算適用
- シャッフル、溶解剤: 効果後の通常消去は通常のスコア計算適用

#### スコアブースター詳細

- **適用範囲**: 通常消去のスコアに適用（アイテム直接消去は除外）
- **適用タイミング**: 使用後からステージ終了まで1.5倍
- **全消しボーナスとの重複**: 両方適用される（1.5 × 1.5 = 2.25倍）
- **小数点処理**: 四捨五入

#### スコア計算例

```
通常消去で800点獲得の場合：
- 通常: 800点
- 全消し達成: 800 × 1.5 = 1,200点
- スコアブースター使用: 800 × 1.5 = 1,200点
- 全消し + スコアブースター: 800 × 1.5 × 1.5 = 1,800点
```

### ゴールド獲得計算

```
獲得ゴールド = 獲得スコア
```

- スコアとゴールドは 1:1 の関係
- 獲得したスコアと同じ量のゴールドが得られる
- ゲーム開始時のゴールドの初期所持量はゼロ

例：

- 800 スコア獲得した場合 = 800G 獲得
- 1,500 スコア獲得した場合 = 1,500G 獲得
- 10,000 スコア獲得した場合 = 10,000G 獲得

## ゲームの終了条件

### ステージクリア条件

- 各ステージに設定された目標スコアを達成することでクリア
- 時間制限なし（じっくり考えられる）
- 手数制限なし（戦略的に考える余地がある）

### ステージクリア条件の詳細

- 目標スコア未達成の場合、画面下部に「リタイア」ボタンが表示される
- 目標スコアを達成すると、「リタイア」ボタンが「クリア」ボタンに変更される
- プレイヤーは「クリア」ボタンを押してステージを終了するか、プレイを続けてより高いスコアを目指すことができる
- 「リタイア」ボタンを押すと、目標スコア未達成でもステージを終了できるが、ゴールドは獲得できない

### 消すブロックがなくなった場合（行き詰まり状態）

- プレイヤーはシャッフルなどのアイテムを使用するか、リタイア/クリアするかを選択
- アイテムがない場合はリタイア/クリアするしかない
- 目標スコア未達成でリタイアした場合はゴールド獲得なし
- 目標スコア達成後にクリアした場合は通常通りゴールド獲得

### ゲーム全体の終了条件

- 全 100 ステージ構成
- 最終ステージ（ステージ 100）をクリアするとゲームクリア画面が表示される

### データ永続化仕様：完全リセット方式

#### 基本方針
- **一切の状態保存を行わない**
- どんな状況でも進行状況は保存されない
- 次回アクセス時は必ずタイトル画面から開始

#### ゲーム中断時の処理
- **ブラウザを閉じる**: 全てリセット
- **タブを切り替える**: 全てリセット  
- **ページをリフレッシュ**: 全てリセット
- **ブラウザバック**: 全てリセット

#### リセットされる情報
- 現在のステージ番号 → 1に戻る
- 所持ゴールド → 0に戻る
- アイテム所持状況 → 全て0に戻る
- ゲーム中の盤面状態 → 破棄

#### 実装上の注意点
- sessionStorageやlocalStorageは使用しない
- メモリ上の状態のみで管理
- ページ遷移やリロード時は必ず初期状態から開始

#### プレイヤーへの注意喚起
- ゲーム開始時に「進行状況は保存されません」という注意書きを表示
- 長時間プレイする際の注意を促す

### ゲームクリア画面

```
┌───────────┐
│ ゲームクリア！      │
├───────────┤
│                     │
│  おめでとう！       │
│  全てのステージを    │
│  クリアしました！    │
│                     │
│  総獲得スコア:      │
│  1,234,567          │
│                     │
│  総獲得ゴールド:    │
│  12,345 G           │
├───────────┤
│ [タイトルへ戻る]    │
└───────────┘
```

## ステージの特徴

### 段階的な難易度の上昇

- 色数の増加: 3 色 →4 色 →5 色 →6 色と段階的に複雑化。最大は 6 色
- 妨害ブロックの導入: 新しい妨害要素を段階的に追加
- 新要素学習: 新しい妨害ブロックが登場したときにはブロックの色数を減らして学習しやすく調整してから徐々に色が増えていく
- 具体的なステージごとの色数や妨害ブロックの詳細は設定ファイルで調整可能

### ブロックの色数と種類

- **基本色の選定**（海のテーマに合わせて）:
  - **深い青** (#1E5799): 深海のイメージ
  - **水色** (#7DB9E8): 浅瀬の海のイメージ
  - **海緑** (#2E8B57): 海藻のイメージ
  - **珊瑚赤** (#FF6347): 珊瑚のイメージ
  - **砂金色** (#F4D03F): 砂浜のイメージ
  - **真珠白** (#F5F5F5): 真珠や貝殻のイメージ
- **ステージ進行による色数の増加**:
  - 基本的に 3 色から始まり、ステージが進むにつれて最大 6 色まで増加
  - 具体的な色数の変化は設定ファイルで調整
- **色の追加順序**:

  - 初期 3 色: 水色、珊瑚赤、砂金色
  - 4 色目: 海緑
  - 5 色目: 深い青
  - 6 色目: 真珠白

- **ブロックのビジュアルデザイン**:
  - **形状**: 丸みを帯びた正方形（海の波に洗われた石のイメージ）
  - **テクスチャ**: 色ごとに微妙な波模様や泡のテクスチャを入れる
  - **エフェクト**: 光の反射効果で水中にいるような雰囲気を演出

### 視覚的フィードバック

- **色の識別性への配慮**:
  - 色覚多様性に配慮し、色だけでなく模様や形状でも区別できるようにする
  - 各色に特徴的な模様を追加（例：深い青には波模様、珊瑚赤には珊瑚の形など）
- **新要素導入時の色数調整**:
  - 新しい妨害ブロックが登場するステージでは、一時的に色数を減らして学習しやすくする
  - 例：氷結 Lv1 が登場するステージ 11 では、通常より色数を減らす
  - 具体的な調整は設定ファイルで行う

### ステージサイズと画面設計

- **ステージサイズ**: 10×14 マス（横 10 マス × 縦 14 マス）
- **画面サイズ**: 横幅 400px 以内、縦幅 710px
- **マスサイズ**: 約 40px×40px
- **画面構成**:
  - 上部 UI（スコア、ステージ情報など）: 約 75px
  - ゲーム盤面: 560px（14 マス ×40px）
  - 下部 UI（アイテムボタンなど）: 約 75px
- **一貫性**: 全ステージで同じサイズを維持

### ステージ目標スコアの設定

- **目標スコア**: 全ステージ一律 500 点
- **難易度調整**: 色数増加と妨害ブロック追加により自然と難化
- **バランス**: 10×14 マスのサイズに対して適切な目標値

### プレイ時間と難易度バランス

- **時間制限**: ゲームには公式の時間制限は設けない（プレイヤーが自分のペースでプレイ可能）
- **想定プレイ時間**: ゲームデザイン上は 1 ステージあたり 3〜5 分でクリアできる難易度バランスを目指す
- **難易度の段階的上昇**: ステージが進行すると妨害ブロックが登場する
- **新要素導入時の配慮**: 新しい妨害ブロックが登場するステージでは、一時的に色数を減らして学習しやすくする
- **難易度調整の柔軟性**: ステージ間の難易度上昇カーブは設定ファイルで調整可能なため、現時点で詳細を深く考える必要はない

## アイテムの使用方法

### アイテムの使用タイミング

- アイテムはゲーム中いつでも使用可能
- ブロック消去の前後どちらのタイミングでも使用できる
- 各装備枠のアイテムは 1 ステージ内で 1 回だけ使用可能

### 共通の操作フロー

1. ゲーム画面下部のアイテムアイコンをタップして選択
2. アイテム固有の操作を実行（対象ブロックの選択など）
3. 効果の適用

### アイテム使用後の表示

- **使用済みアイテムの視覚表現**:
  - **グレーアウト**: 使用済みアイテムはアイコンと背景がグレーアウト（彩度を下げる）
  - **オーバーレイ**: 使用済みアイテムには「使用済」のアイコン（チェックマーク）を表示
  - **透明度**: 使用済みアイテムは半透明（アルファ値約 50%）に表示
- **アニメーション効果**:
  - **使用時**: アイテム使用時にアイコンが一瞬拡大 → 縮小するアニメーション（0.2 秒程度）
  - **使用後**: グレーアウトへの変化をスムーズなトランジションで表現（0.3 秒程度）
- **ツールチップ**:

  - 使用済みアイテムをタップした際に「このアイテムはすでに使用済みです」というツールチップを表示
  - 初回プレイ時には使用済み状態の説明をチュートリアルで表示

- **アクセシビリティへの配慮**:
  - 色だけでなく形状や記号でも使用済み状態を表現（色覚多様性への配慮）
  - 使用済みアイテムには斜線や × マークなどの視覚的要素を追加

### ブロック消去のアニメーション

- **消去時のエフェクト**:
  - **泡エフェクト**: ブロックが消える際に小さな泡が発生し、上昇していく（0.3 秒程度）
  - **フェードアウト**: ブロックが徐々に透明になりながら消える
- **落下時のアニメーション**:
  - **水中感**: わずかに左右に揺れながら落下する（水の抵抗を表現）
  - **着地時の小さな波紋**: ブロックが着地した際に小さな波紋が発生
  - **落下速度**: 通常の重力よりやや遅め（水中感を演出）
- **全消し時の特別エフェクト**:
  - **大きな波**: 画面全体に波のアニメーションが広がる
  - **祝福テキスト**: 「全消しボーナス！」などのテキスト表示

### アイテム別の詳細な使用方法

#### スワップ

- **使用方法**: 対象の 2 つのブロックを順番にタップ
- **操作手順**:
  1. スワップアイテムを選択
  2. 入れ替えたい 1 つ目のブロックをタップ（ハイライト表示）
  3. 入れ替えたい 2 つ目のブロックをタップ
  4. 2 つのブロックが入れ替わる
- **制限**: 岩ブロックと鋼鉄ブロック以外選択可能

#### チェンジワン

- **使用方法**: 対象ブロックをタップし、変更したい色を選択
- **操作手順**:
  1. チェンジワンアイテムを選択
  2. 色を変えたいブロックをタップ（ハイライト表示）
  3. 画面に表示される色パレットから変更したい色をタップ
  4. ブロックの色が変更される
- **制限**: 岩ブロックと鋼鉄ブロック以外選択可能

#### ミニ爆弾

- **使用方法**: 消去したいブロックをタップ
- **操作手順**:
  1. ミニ爆弾アイテムを選択
  2. 消去したい通常ブロックをタップ
  3. ブロックが消去される
- **制限**: 通常ブロックのみ選択可能

#### シャッフル

- **使用方法**: アイテム選択で即時発動
- **操作手順**:
  1. シャッフルアイテムを選択
  2. 確認ダイアログで「はい」をタップ
  3. 盤面の通常ブロックがシャッフルされる（妨害ブロックの位置は変わらない）
- **制限**: なし（全体効果）

#### 溶解剤

- **使用方法**: 対象の氷結ブロックをタップ
- **操作手順**:
  1. 溶解剤アイテムを選択
  2. 解除したい氷結ブロックをタップ
  3. 氷結レベルが 1 段階下がる（Lv2→Lv1、Lv1→ 解除）
- **制限**: 氷結ブロックのみ選択可能

#### チェンジエリア

- **使用方法**: 対象ブロックをタップし、変更したい色を選択
- **操作手順**:
  1. チェンジエリアアイテムを選択
  2. 色を変えたいブロックをタップ（ハイライト表示）
  3. 画面に表示される色パレットから変更したい色をタップ
  4. 選択したブロックと同じ色で隣接している全てのブロック（通常のさめがめルールで一度に消せる範囲全体）が選択した色に変更
- **制限**: 岩ブロックと鋼鉄ブロック以外選択可能

#### カウンター+リセット

- **使用方法**: 対象のカウンター+ブロックをタップ
- **操作手順**:
  1. カウンター+リセットアイテムを選択
  2. リセットしたいカウンター+ブロックをタップ
  3. カウンター+ブロックが通常ブロックに変化
- **制限**: カウンター+ブロックのみ選択可能

#### 爆弾

- **使用方法**: 爆発させたい場所をタップ
- **操作手順**:
  1. 爆弾アイテムを選択
  2. 爆発させたい場所（中心点）をタップ
  3. 3×3 の範囲のブロックが消去される
- **制限**: 鋼鉄ブロック以外のブロックを消去可能

#### アドプラス

- **使用方法**: 対象のカウンターブロックをタップ
- **操作手順**:
  1. アドプラスアイテムを選択
  2. 変換したいカウンターブロックをタップ
  3. カウンターブロックがカウンター+ブロックに変化
- **制限**: カウンターブロックのみ選択可能

#### スコアブースター

- **使用方法**: 選択で即時発動
- **操作手順**:
  1. スコアブースターアイテムを選択
  2. 確認ダイアログで「はい」をタップ
  3. 効果が発動し、ステージ終了までスコアが 1.5 倍になる
- **制限**: なし（全体効果）

#### ハンマー

- **使用方法**: 対象の岩ブロックをタップ
- **操作手順**:
  1. ハンマーアイテムを選択
  2. 破壊したい岩ブロックをタップ
  3. 岩ブロックが消去される
- **制限**: 岩ブロックのみ選択可能

#### 鋼鉄ハンマー

- **使用方法**: 対象の鋼鉄ブロックをタップ
- **操作手順**:
  1. 鋼鉄ハンマーアイテムを選択
  2. 破壊したい鋼鉄ブロックをタップ
  3. 鋼鉄ブロックが消去される
- **制限**: 鋼鉄ブロックのみ選択可能

#### スペシャルハンマー

- **使用方法**: 対象のブロックをタップ
- **操作手順**:
  1. スペシャルハンマーアイテムを選択
  2. 破壊したいブロックをタップ
  3. 選択したブロックが消去される
- **制限**: すべてのブロックタイプに使用可能

## ブロックの初期配置

### 配置ルール

- **通常ブロック**: ランダムに配置
- **妨害ブロック**: 各ステージで固定位置に配置
- **ゲーム性**: ランダム性と戦略性のバランスを重視

### ブロックの初期配置の詳細

- **通常ブロック**: 色と位置はランダムに決定するが、初期状態で少なくとも 1 箇所は消去可能な状態（同色ブロックが 2 つ以上隣接している状態）になるよう制御
- **配置アルゴリズム**: ランダム配置後、消去可能な箇所がない場合は再配置を行う
- **バランス調整**: 初期状態で消去可能な箇所が多すぎる場合（例：全体の 30%以上）も再配置を検討

### 妨害ブロックの配置設計

- **戦略的配置**: 特定のパターンや形状を作り出す配置
- **難易度調整**: 妨害ブロックの位置で難易度を調整
- **学習要素**: プレイヤーが妨害ブロックの配置を覚えることで戦略を立てやすくなる
- **実装方法**: 妨害ブロックの具体的な配置パターンや設定方法は設定ファイルで管理するため、現時点で詳細を深く考える必要はない

### 配置の一貫性

- **同一ステージ**: 同じステージでは妨害ブロックの配置は常に同じ
- **リトライ時**: 通常ブロックは再シャッフルされるが、妨害ブロックの位置は変わらない

## ステージ設定の実装方法

### TypeScript による設定ファイル

- **ステージ設定ファイル**: 各ステージの詳細設定を TypeScript で定義
  - **色数**: 各ステージで使用する色の数（3〜6 色）
  - **目標スコア**: 各ステージのクリア条件（基本 500 点）
  - **妨害ブロック**: 種類、位置、パラメータ（カウンター値など）
  - **色数進行**: ステージごとの色数（例：ステージ 1 は 3 色、2 は 4 色など）は実装時に調整

### 初期ステージ設定（ステージ1-10）

```typescript
const initialStageConfigs = [
  // ステージ1-3: 基本操作習得（3色、妨害ブロックなし）
  { stage: 1, colors: 3, targetScore: 500, obstacles: [] },
  { stage: 2, colors: 3, targetScore: 500, obstacles: [] },
  { stage: 3, colors: 3, targetScore: 500, obstacles: [] },
  
  // ステージ4-6: 色数増加（4色）
  { stage: 4, colors: 4, targetScore: 500, obstacles: [] },
  { stage: 5, colors: 4, targetScore: 500, obstacles: [] },
  { stage: 6, colors: 4, targetScore: 500, obstacles: [] },
  
  // ステージ7-10: さらに色数増加（5色）
  { stage: 7, colors: 5, targetScore: 500, obstacles: [] },
  { stage: 8, colors: 5, targetScore: 500, obstacles: [] },
  { stage: 9, colors: 5, targetScore: 500, obstacles: [] },
  { stage: 10, colors: 5, targetScore: 500, obstacles: [] },
];
```

### 設定ファイルの利点

- **型安全性**: TypeScript の型システムによりミスを防止
- **メンテナンス性**: コメント追加や関数化による可読性向上
- **拡張性**: 新ステージや新要素の追加が容易
- **モジュール化**: 関連設定を別ファイルに分けて管理可能

## エラーハンドリング仕様

### 1. ガチャ関連のエラー

#### ゴールド不足
- **対処法**:
  - ガチャボタンを無効化（グレーアウト）
  - タップ時に「ゴールドが不足しています」メッセージ表示
  - 必要ゴールド数と現在の所持数を表示

#### アイテム所持上限到達
- **対処法**:
  - ガチャは通常通り実行される
  - 上限を超えるアイテムは自動的に破棄
  - 「所持上限のため○○×2を破棄しました」メッセージ表示
  - ゴールドは通常通り消費される

### 2. アイテム使用時のエラー

#### 不正な対象選択
- ハンマーを通常ブロックに使用: 「このアイテムは岩ブロック専用です」
- 溶解剤を通常ブロックに使用: 「このアイテムは氷結ブロック専用です」
- 鋼鉄ハンマーを岩ブロックに使用: 「このアイテムは鋼鉄ブロック専用です」

#### アイテム装備時のエラー
- 通常枠にS・Aレアアイテム装備: 「このアイテムはこの枠に装備できません」
- 使用済みアイテムの再使用: 「このアイテムはすでに使用済みです」

#### 爆弾使用時の注意
- 爆弾は任意の場所に使用可能
- 鋼鉄ブロックがある場合は「鋼鉄ブロックは破壊されません」という情報表示（エラーではない）

### 3. ゲーム進行時のエラー

#### 消去不可能状態
- 「消去可能なブロックがありません」メッセージ
- シャッフルアイテムの使用を促す
- リタイアボタンを強調表示

#### 無効な操作
- 消去不可能なブロック群をタップ: 「このブロックは消去できません」
- 1個のブロックをタップ: 「2個以上の同色ブロックを選択してください」

### 4. システムエラー

#### 予期しないエラー
- JavaScript例外: 「エラーが発生しました。ページを再読み込みしてください」
- データ不整合: 初期状態にリセット

### エラーハンドリングの基本方針

- **予防的UI設計**: 無効な操作ができないようにボタンを無効化
- **分かりやすいメッセージ**: 具体的で理解しやすい説明と解決方法の提示
- **ゲーム進行の継続性**: エラーが発生してもゲームが止まらないよう配慮
## UI/UX詳細仕様

### 高優先度

#### 1. ボタンの無効化状態表現

##### ガチャボタン（ゴールド不足時）
- **視覚的変化**:
  - 背景色: 通常の青色 → グレー（#CCCCCC）
  - テキスト色: 白色 → 暗いグレー（#666666）
  - 透明度: 100% → 60%
  - ボーダー: 通常のボーダー → 点線ボーダー
- **操作時の反応**:
  - カーソル: pointer → not-allowed
  - タップ時: 無反応 + エラーメッセージ表示
  - ホバー効果: なし

##### アイテムボタン（使用済み・装備不可時）
- **使用済みアイテム**:
  - 背景: グレーアウト + 斜線オーバーレイ
  - アイコン: 彩度50%減 + 透明度50%
  - チェックマーク: 右上に小さく表示
  - タップ時: 「すでに使用済みです」メッセージ
- **装備不可アイテム**:
  - 背景: 赤みがかったグレー
  - アイコン: 透明度70%
  - 禁止マーク: 中央に×印オーバーレイ
  - タップ時: 「この枠に装備できません」メッセージ

#### 2. エラーメッセージの表示方法

##### 表示形式
- **トースト形式（推奨）**:
  - 位置: 画面上部中央
  - 背景: 半透明の赤色（#FF0000AA）
  - テキスト: 白色、太字
  - 表示時間: 3秒間
  - アニメーション: 上からスライドイン → フェードアウト
- **モーダル形式（重要なエラー時）**:
  - 背景: 半透明オーバーレイ
  - ダイアログ: 白背景、角丸
  - ボタン: 「OK」で閉じる
  - 他の操作をブロック

##### エラー種別による色分け
- **エラー（赤）**: ゴールド不足、装備不可など
- **警告（オレンジ）**: アイテム破棄、鋼鉄ブロック破壊不可など
- **情報（青）**: 操作ヒント、ガイダンスなど

#### 3. ローディング状態の表現

##### ガチャ演出中
- **ボタン状態**:
  - ガチャボタン無効化 + スピナー表示
  - 「抽選中...」テキスト
  - 他のボタンも一時的に無効化
- **背景エフェクト**:
  - 画面全体に薄い波のアニメーション
  - 宝箱浮上のアニメーション（2-3秒）
  - 音響: 水中の泡音

##### ステージ遷移時
- **画面遷移**:
  - 現在の画面をフェードアウト（0.3秒）
  - 「ステージ○○」テキスト表示（1秒）
  - 新しい画面をフェードイン（0.3秒）
- **盤面生成中**:
  - 「盤面を生成中...」表示
  - 波紋が広がるアニメーション
  - ブロックが上から順番に配置されるアニメーション

### 中優先度

#### 1. 基本的な効果音

##### 操作音
- **ボタンタップ音**:
  - 通常ボタン: 軽い水滴音（0.1秒）
  - 重要ボタン（ガチャ、クリアなど）: より響く水音（0.2秒）
  - 無効ボタン: 低い「ブー」音（0.1秒）
- **ブロック操作音**:
  - ブロック選択: 小さな泡音
  - ブロック消去: 泡がはじける音（消去数に応じて音の大きさ変化）
  - ブロック落下: 水中移動音（連続的な小さな音）
  - 着地音: 軽い水しぶき音

##### 特別な効果音
- **全消し達成**: 大きな波の音 + 成功音（2秒）
- **ステージクリア**: 勝利のファンファーレ（海バージョン、3秒）
- **ガチャ実行**: 宝箱を開ける音 + 水中エコー（1秒）
- **レアアイテム獲得**: キラキラ音 + 特別な和音（1.5秒）

#### 2. スコア表示のアニメーション

##### スコア獲得時
- **通常消去**:
  - 消去したブロック位置に「+○○」テキスト表示
  - テキストが上に浮上しながらフェードアウト（1秒）
  - 色: 白色、太字、影付き
- **大量消去（10個以上）**:
  - より大きなテキスト（1.5倍サイズ）
  - 金色のテキスト + 光るエフェクト
  - 「GREAT!」などの称賛テキストも表示
- **全消しボーナス**:
  - 画面中央に大きく「全消しボーナス！」
  - 虹色のテキスト + 波のエフェクト
  - スコア数値が回転しながら加算される演出

##### スコア更新アニメーション
- **リアルタイム更新**:
  - 数値が滑らかにカウントアップ（0.5秒かけて）
  - 大幅な増加時は数値が一瞬拡大→縮小
  - 目標スコア達成時は緑色に点滅（3回）

#### 3. アイテム使用時のフィードバック

##### 使用時の視覚効果
- **爆弾**:
  - 爆発の中心から波紋が広がる
  - 影響範囲を一瞬ハイライト表示
  - 消去されるブロックが順番に消える（0.1秒間隔）
- **ハンマー系**:
  - ハンマーが上から降ってくるアニメーション
  - 対象ブロックにヒビが入る→砕ける演出
  - 破片が飛び散るエフェクト
- **溶解剤**:
  - 氷結ブロックに液体がかかる演出
  - 氷が徐々に溶けるアニメーション（1秒）
  - 水滴が滴り落ちるエフェクト
- **シャッフル**:
  - 全ブロックが一瞬浮上
  - 渦巻き状に回転しながら再配置
  - 新しい位置に着地する演出（2秒）

##### 使用後の状態変化
- **アイテムアイコンの変化**:
  - 使用時: 0.2秒で1.2倍に拡大→0.3秒で通常サイズに戻る
  - グレーアウト: 0.3秒かけて滑らかに変化
  - チェックマーク: 右上から回転しながら登場
- **装備枠の表示**:
  - 空の枠: 点線ボーダー + 「未選択」テキスト
  - 装備済み: 実線ボーダー + アイテムアイコン
  - 使用済み: グレーアウト + チェックマーク

### 低優先度

#### 1. 高度なアニメーション効果

##### 背景アニメーション
- **メイン画面**:
  - 海の波が緩やかに動く背景（無限ループ）
  - 小さな泡が時々浮上するエフェクト
  - 遠景に魚影がゆっくり通り過ぎる演出
- **ゲーム画面**:
  - 盤面の背景に海底の砂が舞うエフェクト
  - 画面端に海藻が揺れるアニメーション
  - 光が水面から差し込む演出（薄く）
- **ガチャ画面**:
  - 宝箱周辺にキラキラエフェクト
  - 海底から気泡が立ち上る演出
  - レア度に応じて光の色が変化

##### 画面遷移エフェクト
- **波のトランジション**:
  - 画面が波のように左右に揺れながらフェード
  - 新しい画面が水中から浮上してくる演出
  - 泡のパーティクルが画面を覆う演出
- **ページめくり風**:
  - 画面が本のページのようにめくれる
  - 海の本をめくっているような演出
  - ページの端に水滴エフェクト

#### 2. 複雑な音響効果

##### 環境音（BGM）
- **タイトル画面**:
  - 穏やかな海の音（波の音、遠くのカモメ）
  - 神秘的な海中音楽（30秒ループ）
  - 音量: 控えめ（他の効果音を邪魔しない）
- **ゲーム画面**:
  - 水中の環境音（泡音、水流音）
  - 集中できる落ち着いた音楽
  - ステージ進行に応じて音楽が少しずつ変化
- **ガチャ画面**:
  - 期待感を高める音楽
  - 宝探しをイメージした冒険的な音楽
  - レア獲得時は特別な音楽に切り替わる

##### 立体音響効果
- **ブロック落下音**:
  - 落下距離に応じて音の高さが変化
  - 左右の位置に応じてステレオ効果
  - 複数ブロック同時落下時は音が重なる
- **爆弾効果音**:
  - 爆発の中心から音が広がる効果
  - エコー効果で水中感を演出
  - 爆発規模に応じて音の迫力が変化

#### 3. 装飾的なエフェクト

##### パーティクルシステム
- **ブロック消去時**:
  - 消去されたブロックから小さな光の粒子が散る
  - 色に応じて異なる色の粒子
  - 粒子が上昇しながら消える（2秒）
- **高スコア達成時**:
  - 画面全体に金色の粒子が舞い散る
  - 星型の粒子がキラキラと光る
  - 虹色の光線が画面を横切る
- **レアアイテム獲得時**:
  - アイテム周辺に光の輪が広がる
  - レア度に応じて異なる色の光
  - 光の粒子が螺旋状に舞い上がる

##### UI装飾
- **ボタンの装飾**:
  - 重要なボタンに微細な光るエフェクト
  - ホバー時に波紋が広がる演出
  - 長押し時にボタンが脈動する演出
- **枠線の装飾**:
  - 特殊枠に金色の装飾模様
  - 通常枠に銀色のシンプルな装飾
  - アクティブな枠は光るボーダー
- **数値表示の装飾**:
  - 大きな数値は影付きで立体的に
  - 重要な数値（スコア、ゴールド）は微細に光る
  - 数値変化時に一瞬光るエフェクト
## ブロック生成ロジックの実装方針

### 1. 初期配置生成の方針

#### 基本アプローチ
- **妨害ブロック優先配置**: 設定ファイルの固定位置に先に配置
- **通常ブロック後配置**: 残りの位置にランダムで色を決定して配置
- **消去可能性保証**: 配置後に消去可能箇所をチェック、条件を満たさない場合は再生成

#### バランス調整
- **最低条件**: 消去可能な箇所が1箇所以上存在
- **上限調整**: 消去可能箇所が多すぎる場合（全体の30%超）は再配置
- **再試行制限**: 一定回数試行しても条件を満たさない場合は強制的に有効な配置を作成

### 2. 重力処理の方針

#### 実装手法
- **Tweenアニメーション採用**: 物理エンジンではなくアニメーションで落下を表現
- **グリッドベース**: 必ずグリッド位置に正確に着地
- **順次処理**: 列ごとに順番に落下処理を実行

#### 演出面
- **水中感の表現**: イージング関数で水の抵抗感を演出
- **微細な揺れ**: 落下中に左右の小さな揺れを追加
- **着地エフェクト**: 着地時に小さな波紋エフェクト

### 3. 行き詰まり検出の方針

#### 検出タイミング
- **ブロック消去後**: 重力処理完了後に自動チェック
- **プレイヤー操作時**: 無効な操作を試行した際にリアルタイムチェック

#### 対処方法
- **UI誘導**: シャッフルアイテムの使用を促すメッセージ表示
- **選択肢提示**: リタイアボタンの強調表示
- **自動処理なし**: プレイヤーの判断に委ねる

### 4. パフォーマンス考慮

#### 最適化方針
- **バッチ処理**: 同時に複数ブロックが落下する場合の効率化
- **アニメーション管理**: 不要なアニメーションの適切な停止・破棄
- **メモリ管理**: ブロックオブジェクトの再利用とガベージコレクション対策
## チュートリアル仕様

### 1. 基本操作の説明

#### ゲーム開始時（必須）
- **さめがめの基本ルール**: 同色ブロック2個以上をタップで消去
- **スコア計算**: ブロック数の二乗でスコア獲得
- **目標**: 目標スコア達成でステージクリア
- **隣接の定義**: 上下左右のみ、斜めは含まない

#### 実際の操作体験
- **チュートリアル専用盤面**: 簡単な配置で基本操作を体験
- **ガイド表示**: 消去可能なブロック群をハイライト表示
- **操作誘導**: 「ここをタップしてください」メッセージ
- **体験学習**: 実際に消去してスコア獲得を体験

### 2. アイテムシステムの説明

#### アイテム装備の概念（ステージ2-3で説明）
- **装備枠の存在**: 特殊枠と通常枠の違い
- **アイテム選択画面**: 使い方と操作方法
- **使用回数**: 装備したアイテムは1ステージで1回使用可能
- **消費タイミング**: 使用しなかった場合は消費されない

#### 装備制限の説明（重要・必須）
- **特殊枠**: S・Aレアアイテム専用（通常アイテムも装備可能）
- **通常枠**: B〜Fレアアイテム専用
- **戦略的選択**: 装備の組み合わせの重要性を説明

### 3. ガチャシステムの説明

#### 初回ガチャ体験（ステージクリア後）
- **ゴールド獲得**: スコアに応じてゴールドを獲得
- **ガチャの引き方**: 1回・10回の選択肢
- **レア度の概念**: アイテムの強さとレア度の関係
- **成長要素**: ステージ進行でより強いアイテムが出現

### 4. 妨害ブロックの段階的説明

#### 新要素登場時のチュートリアル
```
氷結Lv1登場時（ステージ11）:
- 氷結ブロックの見た目と特徴
- 解除方法: 隣接する同色ブロックを消去
- 解除後は通常ブロックとして機能

カウンター+登場時（ステージ21）:
- カウンターの数字の意味
- 指定数以上のグループで消去可能
- 実際の消去例を表示

その他妨害ブロック:
- 各ブロック登場時に同様の説明を実施
```

### 5. チュートリアルの表示方式

#### 段階的な説明
- **分割学習**: 一度に全てを説明しない
- **タイミング**: 新要素登場時にその都度説明
- **スキップ機能**: 2回目以降のプレイ時はスキップ可能
- **復習機能**: 重要な情報は後から確認可能

#### 視覚的なガイド
- **操作誘導**: 矢印やハイライトで操作箇所を明示
- **アニメーション**: 操作方法を動的に表示
- **オーバーレイ**: 半透明で他の操作をブロック
- **ナビゲーション**: 「次へ」「スキップ」ボタンの配置

### チュートリアルの実装方針

#### 1. 段階的な学習カーブ
```
ステージ1: 基本操作のみ
ステージ2-3: アイテム装備の概念
ステージ4-5: ガチャシステム
ステージ11: 氷結ブロック
ステージ21: カウンターブロック
以降: 新要素登場時に説明
```

#### 2. 学習の強制度
```
必須チュートリアル:
- 基本操作（スキップ不可）
- アイテム装備制限（重要なため必須）

任意チュートリアル:
- 新妨害ブロックの説明（スキップ可能）
- 高度なテクニック（スキップ可能）
```

#### 3. 復習機能
- **遊び方ボタン**: メイン画面からアクセス可能
- **要素別説明**: 各要素の説明を後から確認可能
- **アイテム詳細**: アイテム一覧画面で効果説明表示

#### 4. プレイヤー配慮
- **簡潔な説明**: 分かりやすく短い文章
- **専門用語回避**: 初心者にも理解しやすい表現
- **体験型学習**: 実際の操作と組み合わせた説明
- **柔軟性**: 理解度に応じてスキップ可能
