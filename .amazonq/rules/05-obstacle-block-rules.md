# 妨害ブロック実装ルール

## 1. 基本概念

### 1.1 妨害ブロックの定義
- 妨害ブロックとは、通常ブロックとは異なる特殊な性質を持つブロックである
- 各マスには通常ブロックか妨害ブロックのどちらか一方のみが存在する
- 妨害ブロックは「オーバーレイ」ではなく「単一のエンティティ」として扱う

### 1.2 重要な原則
- **単一エンティティの原則**: 妨害ブロックの下に通常ブロックが存在することはない
- **マス占有の原則**: 1つのマスには1種類のブロックのみ存在する
- **視覚的一貫性**: 妨害ブロックは見た目でも単一のブロックとして表現する

## 2. 妨害ブロックの種類と特性

### 2.1 氷結ブロック
- **氷結Lv1**: 隣接する同色ブロックが1回消去されると解除される
- **氷結Lv2**: 隣接する同色ブロックが2回消去されると解除される
- **視覚表現**: 青みがかった色で氷の質感を表現し、氷の結晶パターンを描画

### 2.2 カウンターブロック
- **カウンター**: ちょうど指定数の同色ブロックグループで消去可能
- **カウンター+**: 指定数以上の同色ブロックグループで消去可能
- **視覚表現**: ブロック自体の色に円形のカウンター表示を組み込む

### 2.3 複合妨害ブロック
- **氷結カウンター**: 氷結が解除されるとカウンターブロックになる
- **氷結カウンター+**: 氷結が解除されるとカウンター+ブロックになる
- **視覚表現**: 青みがかった色と氷の結晶パターンにカウンター表示を組み込む

### 2.4 特殊妨害ブロック
- **岩ブロック**: アイテムでのみ消去可能、重力の影響を受ける
- **鋼鉄ブロック**: 特殊アイテムでのみ消去可能、重力の影響を受けない
- **視覚表現**: それぞれ岩や鋼鉄の質感を持つ単一のブロックとして表現

## 3. 実装ルール

### 3.1 データ構造
- 妨害ブロックは `Block` インターフェースを実装し、`type` プロパティで種類を区別する
- 妨害ブロックの状態は `ObstacleBlock` クラスで管理する
- 各妨害ブロックタイプは `ObstacleBlock` を継承した具象クラスとして実装する

### 3.2 描画ルール
- 妨害ブロックは単一のエンティティとして描画する
- 「基本ブロック + オーバーレイ」という表現は使用しない
- 色と特殊効果（氷、カウンターなど）は単一のブロック内に統合する

### 3.3 色の表現
- 妨害ブロックの色は、ブロック自体の色として表現する
- 氷結ブロックの場合は、元の色と氷の青色をブレンドして表現する
- 色を示す小さな円などの別オブジェクトは使用しない

### 3.4 状態変化
- 妨害ブロックの状態変化（例：氷結Lv2→Lv1）は、ブロック全体の変化として表現する
- 状態変化時は新しい `ObstacleBlock` インスタンスを作成する

## 4. デバッグと検証

### 4.1 アスキーアート表示
- 妨害ブロックの配置と種類をアスキーアートで可視化する
- 各ブロックタイプと色を記号で表現し、グリッド形式で出力する

### 4.2 検証ポイント
- 同じマスに複数のブロックが存在していないか
- 妨害ブロックが正しく単一のエンティティとして描画されているか
- 状態変化が正しく処理されているか

## 5. 注意事項

### 5.1 避けるべき実装
- 妨害ブロックの下に通常ブロックを配置する実装
- 半透明のオーバーレイとして妨害効果を表現する実装
- 複数のレイヤーを重ねて妨害ブロックを表現する実装

### 5.2 推奨される実装
- 単一のブロックとして妨害ブロックを表現する実装
- 色と特殊効果を統合した視覚表現
- 明確な状態管理と状態変化の処理
